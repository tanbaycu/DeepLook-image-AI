<!DOCTYPE html>
<html lang="vi" class="h-full bg-gray-50">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân tích Hình ảnh Chuyên sâu AI - tanbaycu</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/jdBhxKtM/Thi-t-k-ch-a-c-t-n-7.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#3B82F6',
                            foreground: '#FFFFFF',
                        },
                        secondary: {
                            DEFAULT: '#1E293B',
                            foreground: '#FFFFFF',
                        },
                    },
                },
            },
        }
    </script>
    <style>
        :root {
            --transition-speed: 0.3s;
        }

        .animate-fade-in {
            animation: fadeIn var(--transition-speed) ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-wave {
            width: 5px;
            height: 100px;
            background: linear-gradient(45deg, #3B82F6, #60A5FA);
            margin: 10px;
            animation: wave 1s linear infinite;
            border-radius: 20px;
        }

        .loading-wave:nth-child(2) {
            animation-delay: 0.1s;
        }

        .loading-wave:nth-child(3) {
            animation-delay: 0.2s;
        }

        .loading-wave:nth-child(4) {
            animation-delay: 0.3s;
        }

        .loading-wave:nth-child(5) {
            animation-delay: 0.4s;
        }

        @keyframes wave {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1);
            }

            100% {
                transform: scale(0);
            }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #3B82F6;
            border-radius: 20px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #2563EB;
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 font-sans text-gray-900">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-12 text-center animate-fade-in">
            <h1
                class="text-5xl md:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-blue-600 mb-4">
                Phân tích Hình ảnh Chuyên sâu AI
            </h1>
            <p class="text-xl md:text-2xl text-gray-600">Khám phá chi tiết ẩn sau mỗi bức ảnh</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <section class="space-y-6 animate-fade-in">
                <div
                    class="bg-white rounded-2xl shadow-lg p-8 transition-all duration-300 hover:shadow-xl border-t-4 border-primary">
                    <h2 class="text-3xl font-bold mb-6 text-secondary flex items-center">
                        <i data-lucide="upload-cloud" class="w-8 h-8 mr-3 text-primary"></i>
                        Tải lên và Phân tích
                    </h2>
                    <div class="space-y-6">
                        <div>
                            <label for="imageUpload" class="block text-lg font-medium mb-2 text-gray-700">Tải lên hình
                                ảnh:</label>
                            <div class="flex items-center justify-center w-full">
                                <label for="imageUpload"
                                    class="flex flex-col items-center justify-center w-full h-64 border-2 border-primary border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors duration-200">
                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                        <i data-lucide="upload-cloud" class="w-12 h-12 mb-4 text-primary"></i>
                                        <p class="mb-2 text-xl text-gray-500"><span class="font-semibold">Nhấp để tải
                                                lên</span> hoặc kéo và thả</p>
                                        <p class="text-sm text-gray-500">PNG, JPG hoặc GIF (Tối đa 10MB)</p>
                                    </div>
                                    <input id="imageUpload" type="file" class="hidden" accept="image/*" />
                                </label>
                            </div>
                        </div>
                        <div id="imagePreview" class="hidden">
                            <img id="previewImage" src="" alt="Xem trước"
                                class="max-w-full h-auto rounded-lg shadow-md">
                        </div>
                        <div>
                            <label for="imageUrl" class="block text-lg font-medium mb-2 text-gray-700">Hoặc nhập URL
                                hình ảnh:</label>
                            <div class="flex">
                                <input type="url" id="imageUrl"
                                    class="flex-grow px-4 py-3 bg-white border-2 border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow duration-200"
                                    placeholder="https://example.com/image.jpg">
                                <button id="fetchImageUrl"
                                    class="px-6 py-3 bg-primary text-white rounded-r-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200">
                                    <i data-lucide="download" class="w-6 h-6"></i>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label for="modelSelect" class="block text-lg font-medium mb-2 text-gray-700">Chọn mô
                                hình:</label>
                            <select id="modelSelect"
                                class="w-full px-4 py-3 bg-white border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow duration-200">
                                <option value="gemini-1.5-pro-002">Gemini 1.5 Pro 002</option>
                                <option value="gemini-1.5-flash-002">Gemini 1.5 Flash 002</option>
                                <option value="gemini-1.5-flash-8b">Gemini 1.5 Flash 8B</option>
                                <option value="gemini-1.5-flash-8b-001">Gemini 1.5 Flash 8B 001</option>
                                <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash Exp</option>
                            </select>
                        </div>
                        <div>
                            <label for="promptInput" class="block text-lg font-medium mb-2 text-gray-700">Nhập prompt mô
                                tả hình ảnh:</label>
                            <textarea id="promptInput" rows="4"
                                class="w-full px-4 py-3 bg-white border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow duration-200"
                                placeholder="Mô tả chi tiết về hình ảnh hoặc đặt câu hỏi cụ thể..."></textarea>
                        </div>
                        <button id="analyzeButtonSimple"
                            class="w-full flex items-center justify-center px-6 py-3 bg-primary text-white text-lg font-semibold rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200">
                            <i data-lucide="search" class="w-6 h-6 mr-2"></i>
                            Phân tích Hình ảnh
                        </button>
                    </div>
                </div>
            </section>

            <section class="space-y-6 animate-fade-in" style="animation-delay: 0.2s;">
                <div
                    class="bg-white rounded-2xl shadow-lg p-8 transition-all duration-300 hover:shadow-xl border-t-4 border-secondary">
                    <h2 class="text-3xl font-bold mb-6 text-secondary flex items-center">
                        <i data-lucide="settings" class="w-8 h-8 mr-3 text-secondary"></i>
                        Tùy chọn Nâng cao
                    </h2>
                    <div class="space-y-6">
                        <div>
                            <label for="analysisType" class="block text-lg font-medium mb-2 text-gray-700">Loại phân
                                tích:</label>
                            <select id="analysisType"
                                class="w-full px-4 py-3 bg-white border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition-shadow duration-200">
                                <option value="general">Phân tích tổng quát</option>
                                <option value="objects">Nhận diện đối tượng</option>
                                <option value="text">Nhận diện văn bản</option>
                                <option value="faces">Nhận diện khuôn mặt</option>
                                <option value="colors">Phân tích màu sắc</option>
                                <option value="composition">Phân tích bố cục</option>
                                <option value="emotion">Phân tích cảm xúc</option>
                                <option value="style">Phân tích phong cách nghệ thuật</option>
                                <option value="context">Phân tích ngữ cảnh</option>
                                <option value="symbolism">Phân tích biểu tượng</option>
                            </select>
                        </div>
                        <div>
                            <label for="detailLevel" class="block text-lg font-medium mb-2 text-gray-700">Mức độ chi
                                tiết:</label>
                            <input type="range" id="detailLevel" min="1" max="5" value="3"
                                class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-secondary">
                            <div class="flex justify-between text-sm text-gray-500 mt-2">
                                <span>Cơ bản</span>
                                <span>Chi tiết</span>
                            </div>
                        </div>
                        <div>
                            <label for="languageStyle" class="block text-lg font-medium mb-2 text-gray-700">Phong cách
                                ngôn ngữ:</label>
                            <select id="languageStyle"
                                class="w-full px-4 py-3 bg-white border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition-shadow duration-200">
                                <option value="academic">Học thuật</option>
                                <option value="conversational">Đàm thoại</option>
                                <option value="technical">Kỹ thuật</option>
                                <option value="creative">Sáng tạo</option>
                            </select>
                        </div>
                        <div>
                            <label for="outputFormat" class="block text-lg font-medium mb-2 text-gray-700">Định dạng kết
                                quả:</label>
                            <select id="outputFormat"
                                class="w-full px-4 py-3 bg-white border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition-shadow duration-200">
                                <option value="paragraph">Đoạn văn</option>
                                <option value="bullet">Danh sách gạch đầu dòng</option>
                                <option value="table">Bảng</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>
                        <button id="analyzeButtonAdvanced"
                            class="w-full flex items-center justify-center px-6 py-3 bg-secondary text-white text-lg font-semibold rounded-lg hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2 transition-colors duration-200">
                            <i data-lucide="search" class="w-6 h-6 mr-2"></i>
                            Phân tích Nâng cao
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <section id="resultSection" class="mt-12 space-y-6 animate-fade-in" style="animation-delay: 0.4s;">
            <div
                class="bg-white rounded-2xl shadow-lg p-8 transition-all duration-300 hover:shadow-xl border-t-4 border-green-500">
                <h2 class="text-3xl font-bold mb-6 text-secondary flex items-center">
                    <i data-lucide="file-text" class="w-8 h-8 mr-3 text-green-500"></i>
                    Kết quả Phân tích
                </h2>
                <div id="loadingAnimation" class="hidden flex justify-center items-center space-x-2 my-8">
                    <div class="loading-wave"></div>
                    <div class="loading-wave"></div>
                    <div class="loading-wave"></div>
                    <div class="loading-wave"></div>
                    <div class="loading-wave"></div>
                </div>
                <div id="result" class="prose prose-lg max-w-none">
                    <p class="text-gray-500">Kết quả phân tích sẽ hiển thị ở đây...</p>
                </div>
            </div>
            <div id="visualizations"
                class="bg-white rounded-2xl shadow-lg p-8 transition-all duration-300 hover:shadow-xl border-t-4 border-yellow-500 hidden">
                <h2 class="text-3xl font-bold mb-6 text-secondary flex items-center">
                    <i data-lucide="bar-chart" class="w-8 h-8 mr-3 text-yellow-500"></i>
                    Trực quan hóa
                </h2>
                <div id="visualizationContent" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Visualization content will be added here dynamically -->
                </div>
            </div>
            <div
                class="bg-white rounded-2xl shadow-lg p-8 transition-all duration-300 hover:shadow-xl border-t-4 border-purple-500">
                <h2 class="text-3xl font-bold mb-6 text-secondary flex items-center">
                    <i data-lucide="share" class="w-8 h-8 mr-3 text-purple-500"></i>
                    Chia sẻ
                </h2>
                <div class="space-y-4">
                    <button id="shareResults"
                        class="w-full flex items-center justify-center px-6 py-3 bg-purple-500 text-white text-lg font-semibold rounded-lg hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors duration-200">
                        <i data-lucide="share-2" class="w-6 h-6 mr-2"></i>
                        Chia sẻ kết quả
                    </button>
                </div>
            </div>
            <div
                class="bg-white rounded-2xl shadow-lg p-8 transition-all duration-300 hover:shadow-xl border-t-4 border-indigo-500">
                <h2 class="text-3xl font-bold mb-6 text-secondary flex items-center">
                    <i data-lucide="history" class="w-8 h-8 mr-3 text-indigo-500"></i>
                    Phân tích gần đây
                </h2>
                <ul id="recentAnalyses" class="space-y-4 max-h-60 overflow-y-auto custom-scrollbar">
                    <!-- Recent analyses will be added here dynamically -->
                </ul>
            </div>
        </section>
    </div>

    <script>
        lucide.createIcons();

        const API_KEY = 'AIzaSyD8Zc-j7kc_FkSF_WXQdxQpc4bGBD5KElU';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/';

        document.getElementById('imageUpload').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('previewImage').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('fetchImageUrl').addEventListener('click', function () {
            const imageUrl = document.getElementById('imageUrl').value;
            if (imageUrl) {
                document.getElementById('previewImage').src = imageUrl;
                document.getElementById('imagePreview').classList.remove('hidden');
            }
        });

        document.getElementById('analyzeButtonSimple').addEventListener('click', analyzeImage);
        document.getElementById('analyzeButtonAdvanced').addEventListener('click', analyzeImage);

        function scrollToResults() {
            const resultSection = document.getElementById('resultSection');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function showLoading() {
            document.getElementById('loadingAnimation').classList.remove('hidden');
            document.getElementById('result').innerHTML = '';
        }

        function hideLoading() {
            document.getElementById('loadingAnimation').classList.add('hidden');
        }

        async function analyzeImage() {
            const imageInput = document.getElementById('imageUpload');
            const imageUrl = document.getElementById('imageUrl').value;
            const promptInput = document.getElementById('promptInput');
            const modelSelect = document.getElementById('modelSelect');
            const analysisType = document.getElementById('analysisType').value;
            const detailLevel = document.getElementById('detailLevel').value;
            const languageStyle = document.getElementById('languageStyle').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const resultElement = document.getElementById('result');
            const visualizationsElement = document.getElementById('visualizations');
            const visualizationContentElement = document.getElementById('visualizationContent');

            if (!imageInput.files[0] && !imageUrl) {
                alert('Vui lòng tải lên hình ảnh hoặc cung cấp URL hình ảnh trước khi phân tích.');
                return;
            }

            scrollToResults();
            showLoading();

            try {
                let imageBase64;
                if (imageInput.files[0]) {
                    imageBase64 = await getBase64(imageInput.files[0]);
                } else {
                    imageBase64 = await getBase64FromUrl(imageUrl);
                }
                const prompt = generatePrompt(promptInput.value, analysisType, detailLevel, languageStyle, outputFormat);
                const selectedModel = modelSelect.value;
                const response = await fetch(`${API_URL}${selectedModel}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                {
                                    inline_data: {
                                        mime_type: imageInput.files[0] ? imageInput.files[0].type : 'image/jpeg',
                                        data: imageBase64
                                    }
                                }
                            ]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error('Lỗi kết nối mạng');
                }

                const data = await response.json();
                const analysisResult = data.candidates[0].content.parts[0].text;
                hideLoading();
                displayAnalysisResult(analysisResult, resultElement, outputFormat);

                // Xử lý trực quan hóa
                const visualizations = generateVisualizations(analysisType, analysisResult);
                if (visualizations) {
                    visualizationContentElement.innerHTML = visualizations;
                    visualizationsElement.classList.remove('hidden');
                } else {
                    visualizationsElement.classList.add('hidden');
                }

                // Thêm phân tích gần đây
                addRecentAnalysis(analysisType);
            } catch (error) {
                console.error('Lỗi:', error);
                hideLoading();
                resultElement.innerHTML = `<p class="text-red-500">Lỗi: ${error.message}</p>`;
            }
        }

        function getBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        async function getBase64FromUrl(url) {
            const response = await fetch(url);
            const blob = await response.blob();
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        function generatePrompt(userPrompt, analysisType, detailLevel, languageStyle, outputFormat) {
            let basePrompt = "Bạn là một chuyên gia phân tích hình ảnh có kinh nghiệm. Hãy phân tích hình ảnh sau đây và cung cấp thông tin chi tiết. ";

            basePrompt += "QUAN TRỌNG: Phản hồi của bạn PHẢI HOÀN TOÀN bằng tiếng Việt. KHÔNG sử dụng bất kỳ từ tiếng Anh nào trong phân tích của bạn. ";

            switch (analysisType) {
                case 'objects':
                    basePrompt += "Tập trung vào việc nhận diện và mô tả chi tiết các đối tượng chính trong hình. Liệt kê các đối tượng và mô tả vị trí, kích thước, màu sắc của chúng. Phân tích mối quan hệ giữa các đối tượng nếu có.";
                    break;
                case 'text':
                    basePrompt += "Nhận diện và trích xuất mọi văn bản xuất hiện trong hình ảnh. Nếu có, hãy phân tích nội dung văn bản đó, bao gồm ngôn ngữ, phong cách, và ý nghĩa trong ngữ cảnh của hình ảnh.";
                    break;
                case 'faces':
                    basePrompt += "Tập trung vào việc nhận diện và mô tả các khuôn mặt trong hình. Phân tích biểu cảm, đặc điểm nổi bật, và ước tính độ tuổi nếu có thể. Nếu có nhiều khuôn mặt, hãy mô tả mối quan hệ có thể có giữa họ.";
                    break;
                case 'colors':
                    basePrompt += "Phân tích bảng màu của hình ảnh. Xác định màu sắc chủ đạo và mô tả cách chúng tương tác với nhau. Giải thích ý nghĩa và cảm xúc mà bảng màu này có thể truyền tải.";
                    break;
                case 'composition':
                    basePrompt += "Phân tích bố cục và cấu trúc của hình ảnh. Mô tả cách các yếu tố được sắp xếp và tác động của chúng đến tổng thể bức ảnh. Xác định các nguyên tắc thiết kế được sử dụng và hiệu quả của chúng.";
                    break;
                case 'emotion':
                    basePrompt += "Phân tích cảm xúc và tâm trạng mà hình ảnh truyền tải. Xác định các yếu tố cụ thể trong hình ảnh góp phần tạo nên cảm xúc đó và giải thích tại sao.";
                    break;
                case 'style':
                    basePrompt += "Phân tích phong cách nghệ thuật của hình ảnh. Xác định các kỹ thuật, phong cách, hoặc trường phái nghệ thuật có thể được áp dụng. So sánh với các tác phẩm nghệ thuật nổi tiếng nếu có thể.";
                    break;
                case 'context':
                    basePrompt += "Phân tích ngữ cảnh của hình ảnh. Xác định thời gian, địa điểm, và bối cảnh văn hóa hoặc lịch sử có thể liên quan. Giải thích ý nghĩa của hình ảnh trong bối cảnh rộng hơn.";
                    break;
                case 'symbolism':
                    basePrompt += "Phân tích các biểu tượng và ẩn dụ trong hình ảnh. Xác định các yếu tố có thể mang ý nghĩa biểu tượng và giải thích ý nghĩa sâu xa của chúng trong ngữ cảnh của hình ảnh.";
                    break;
                default:
                    basePrompt += "Cung cấp một phân tích tổng quát về nội dung, ý nghĩa và bối cảnh của hình ảnh. Bao gồm các yếu tố như đối tượng, màu sắc, bố cục, và ý nghĩa tổng thể.";
            }

            basePrompt += `Mức độ chi tiết yêu cầu: ${detailLevel}/5. Hãy điều chỉnh độ sâu và phạm vi của phân tích theo mức độ này. `;

            switch (languageStyle) {
                case 'academic':
                    basePrompt += "Sử dụng ngôn ngữ học thuật và chính thức trong phân tích của bạn. ";
                    break;
                case 'conversational':
                    basePrompt += "Sử dụng ngôn ngữ đàm thoại và dễ hiểu trong phân tích của bạn. ";
                    break;
                case 'technical':
                    basePrompt += "Sử dụng ngôn ngữ kỹ thuật và chuyên ngành trong phân tích của bạn. ";
                    break;
                case 'creative':
                    basePrompt += "Sử dụng ngôn ngữ sáng tạo và hình tượng trong phân tích của bạn. ";
                    break;
            }

            switch (outputFormat) {
                case 'paragraph':
                    basePrompt += "Trình bày kết quả dưới dạng các đoạn văn có cấu trúc. ";
                    break;
                case 'bullet':
                    basePrompt += "Trình bày kết quả dưới dạng danh sách gạch đầu dòng. ";
                    break;
                case 'table':
                    basePrompt += "Trình bày kết quả dưới dạng bảng Markdown nếu có thể. ";
                    break;
                case 'json':
                    basePrompt += "Trình bày kết quả dưới dạng chuỗi JSON hợp lệ. ";
                    break;
            }

            if (userPrompt) {
                basePrompt += `Ngoài ra, hãy trả lời câu hỏi sau của người dùng: ${userPrompt}. Đảm bảo câu trả lời của bạn liên quan trực tiếp đến hình ảnh và phân tích của bạn.`;
            }

            return basePrompt;
        }

        function displayAnalysisResult(analysisText, resultElement, outputFormat) {
            let formattedAnalysis = analysisText;

            if (outputFormat === 'json') {
                try {
                    const jsonObj = JSON.parse(analysisText);
                    formattedAnalysis = JSON.stringify(jsonObj, null, 2);
                    formattedAnalysis = '<pre><code>' + formattedAnalysis + '</code></pre>';
                } catch (e) {
                    console.error('Lỗi khi phân tích JSON:', e);
                }
            } else {
                formattedAnalysis = marked.parse(analysisText);
            }

            resultElement.innerHTML = formattedAnalysis;
        }

        function generateVisualizations(analysisType, analysisResult) {
            let visualizations = '';

            switch (analysisType) {
                case 'colors':
                    visualizations += generateColorPalette(analysisResult);
                    break;
                case 'objects':
                    visualizations += generateObjectDistribution(analysisResult);
                    break;
                case 'emotion':
                    visualizations += generateEmotionChart(analysisResult);
                    break;
                case 'faces':
                    visualizations += generateFaceAnalysis(analysisResult);
                    break;
                case 'composition':
                    visualizations += generateCompositionAnalysis(analysisResult);
                    break;
            }

            return visualizations;
        }

        function generateColorPalette(analysisResult) {
            const colors = extractColorsFromAnalysis(analysisResult);
            let html = '<div class="color-palette flex flex-wrap justify-center gap-4 mb-6">';
            colors.forEach(color => {
                html += `
                    <div class="color-item text-center">
                        <div class="w-16 h-16 rounded-full shadow-lg" style="background-color: ${color};" title="${color}"></div>
                        <span class="text-sm mt-2 block">${color}</span>
                    </div>`;
            });
            html += '</div>';
            return html;
        }

        function generateObjectDistribution(analysisResult) {
            const objects = extractObjectsFromAnalysis(analysisResult);
            let html = '<div class="object-distribution mb-6">';
            html += '<canvas id="objectChart"></canvas>';
            html += '</div>';

            setTimeout(() => {
                const ctx = document.getElementById('objectChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(objects),
                        datasets: [{
                            label: 'Số lượng đối tượng',
                            data: Object.values(objects),
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }, 0);

            return html;
        }

        function generateEmotionChart(analysisResult) {
            const emotions = extractEmotionsFromAnalysis(analysisResult);
            let html = '<div class="emotion-chart mb-6">';
            html += '<canvas id="emotionChart"></canvas>';
            html += '</div>';

            setTimeout(() => {
                const ctx = document.getElementById('emotionChart').getContext('2d');
                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: Object.keys(emotions),
                        datasets: [{
                            label: 'Cường độ cảm xúc',
                            data: Object.values(emotions),
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scale: {
                            ticks: {
                                beginAtZero: true,
                                max: 5
                            }
                        }
                    }
                });
            }, 0);

            return html;
        }

        function generateFaceAnalysis(analysisResult) {
            const faceData = extractFaceDataFromAnalysis(analysisResult);
            let html = '<div class="face-analysis mb-6">';
            html += '<h3 class="text-xl font-semibold mb-4">Phân tích khuôn mặt</h3>';
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
            faceData.forEach(face => {
                html += `
                    <div class="bg-gray-100 p-4 rounded-lg shadow">
                        <p class="font-medium">Khuôn mặt ${face.id}</p>
                        <p>Biểu cảm: ${face.expression}</p>
                        <p>Độ tuổi ước tính: ${face.age}</p>
                    </div>`;
            });
            html += '</div></div>';
            return html;
        }

        function generateCompositionAnalysis(analysisResult) {
            const compositionData = extractCompositionDataFromAnalysis(analysisResult);
            let html = '<div class="composition-analysis mb-6">';
            html += '<h3 class="text-xl font-semibold mb-4">Phân tích bố cục</h3>';
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
            Object.entries(compositionData).forEach(([key, value]) => {
                html += `
                    <div class="bg-gray-100 p-4 rounded-lg shadow">
                        <p class="font-medium">${key}</p>
                        <p>${value}</p>
                    </div>`;
            });
            html += '</div></div>';
            return html;
        }

        function extractColorsFromAnalysis(analysisResult) {
            // Giả lập việc trích xuất màu sắc từ kết quả phân tích
            return ['#FF5733', '#33FF57', '#3357FF', '#F3FF33', '#FF33F3'];
        }

        function extractObjectsFromAnalysis(analysisResult) {
            // Giả lập việc trích xuất đối tượng và số lượng từ kết quả phân tích
            return { 'Người': 3, 'Cây': 2, 'Xe': 1, 'Tòa nhà': 4 };
        }

        function extractEmotionsFromAnalysis(analysisResult) {
            // Giả lập việc trích xuất cảm xúc và cường độ từ kết quả phân tích
            return { 'Hạnh phúc': 4, 'Buồn': 1, 'Tức giận': 2, 'Ngạc nhiên': 3, 'Sợ hãi': 1 };
        }

        function extractFaceDataFromAnalysis(analysisResult) {
            // Giả lập việc trích xuất dữ liệu khuôn mặt từ kết quả phân tích
            return [
                { id: 1, expression: 'Hạnh phúc', age: '25-30' },
                { id: 2, expression: 'Nghiêm túc', age: '40-45' }
            ];
        }

        function extractCompositionDataFromAnalysis(analysisResult) {
            // Giả lập việc trích xuất dữ liệu bố cục từ kết quả phân tích
            return {
                'Quy tắc phần ba': 'Áp dụng',
                'Điểm nhấn': 'Trung tâm hình ảnh',
                'Cân bằng': 'Đối xứng'
            };
        }

        function addRecentAnalysis(analysisType) {
            const recentList = document.getElementById('recentAnalyses');
            const listItem = document.createElement('li');
            listItem.className = 'flex items-center space-x-3 p-3 bg-gray-100 rounded-lg transition-colors duration-200 hover:bg-gray-200';
            listItem.innerHTML = `
                <i data-lucide="${getAnalysisTypeIcon(analysisType)}" class="w-6 h-6 text-indigo-500"></i>
                <div>
                    <span class="font-medium">${getAnalysisTypeName(analysisType)}</span>
                    <span class="text-sm text-gray-500 block">${new Date().toLocaleTimeString()}</span>
                </div>
            `;
            recentList.insertBefore(listItem, recentList.firstChild);
            if (recentList.children.length > 5) {
                recentList.removeChild(recentList.lastChild);
            }
            lucide.createIcons();
        }

        function getAnalysisTypeIcon(analysisType) {
            switch (analysisType) {
                case 'general': return 'eye';
                case 'objects': return 'box';
                case 'text': return 'type';
                case 'faces': return 'user';
                case 'colors': return 'palette';
                case 'composition': return 'layout';
                case 'emotion': return 'smile';
                case 'style': return 'brush';
                case 'context': return 'map';
                case 'symbolism': return 'star';
                default: return 'image';
            }
        }

        function getAnalysisTypeName(analysisType) {
            switch (analysisType) {
                case 'general': return 'Phân tích tổng quát';
                case 'objects': return 'Nhận diện đối tượng';
                case 'text': return 'Nhận diện văn bản';
                case 'faces': return 'Nhận diện khuôn mặt';
                case 'colors': return 'Phân tích màu sắc';
                case 'composition': return 'Phân tích bố cục';
                case 'emotion': return 'Phân tích cảm xúc';
                case 'style': return 'Phân tích phong cách nghệ thuật';
                case 'context': return 'Phân tích ngữ cảnh';
                case 'symbolism': return 'Phân tích biểu tượng';
                default: return 'Phân tích không xác định';
            }
        }

        document.getElementById('shareResults').addEventListener('click', function () {
            if (navigator.share) {
                navigator.share({
                    title: 'Kết quả phân tích hình ảnh',
                    text: document.getElementById('result').innerText,
                    url: window.location.href
                }).then(() => console.log('Chia sẻ thành công'))
                    .catch((error) => console.log('Lỗi khi chia sẻ:', error));
            } else {
                alert('Trình duyệt của bạn không hỗ trợ tính năng chia sẻ.');
            }
        });
    </script>
</body>

</html>